{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "Image" -}}
{{- $width := .Get "width" | default "150px" -}}
{{- $gap := .Get "gap" | default "50px" -}}
{{- $content := .Inner -}}

{{/* Check if src is a relative path (no leading /) - if so, look in page bundle */}}
{{- $imagePath := $src -}}
{{- if not (hasPrefix $src "/") -}}
  {{/* Try to get from page resources first */}}
  {{- with .Page.Resources.GetMatch $src -}}
    {{- $imagePath = .RelPermalink -}}
  {{- else -}}
    {{/* Fallback to global resources if not in page bundle */}}
    {{- with resources.Get (printf "images/%s" $src) -}}
      {{- $imagePath = .RelPermalink -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- $id := .Get "id" | default (printf "modal-%s" (md5 $imagePath)) -}}

<style>
#{{ $id }} {
  display: none;
  position: fixed;
  z-index: 9999;
  padding-top: 50px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.7);
  cursor: pointer;
}
#{{ $id }} .modal-content {
  margin: auto;
  display: block;
  max-width: 90%;
  max-height: 90%;
}
#{{ $id }} .close-modal {
  position: absolute;
  top: 15px;
  right: 35px;
  color: #f1f1f1;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
}
#{{ $id }} .close-modal:hover {
  color: #bbb;
}
</style>

<div style="display: flex; gap: {{ $gap }}; align-items: flex-start;">
  <div style="flex: 0 0 {{ $width }};">
    <img src="{{ $imagePath }}" alt="{{ $alt }}" style="width: {{ $width }}; height: auto; cursor: pointer;" title="Click to view full size" onclick="document.getElementById('{{ $id }}').style.display='block'">
  </div>
  <div style="flex: 1;">
    {{ $content | markdownify }}
  </div>
</div>

<div id="{{ $id }}" onclick="this.style.display='none'">
  <span class="close-modal">&times;</span>
  <img class="modal-content" src="{{ $imagePath }}" alt="{{ $alt }}">
</div>
